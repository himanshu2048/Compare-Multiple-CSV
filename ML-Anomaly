import pandas as pd
import matplotlib.pyplot as plt

# Replace 'your_file.csv' with the actual file path
file_path = 'your_file.csv'

# Load CSV into DataFrame
df = pd.read_csv(file_path)

# Exclude success response codes
exclude_response_codes = [200, 201, 204]
df_filtered = df[~df['response_code'].isin(exclude_response_codes)]

# Convert 'timestamp' column to datetime format
df_filtered['timestamp'] = pd.to_datetime(df_filtered['timestamp'])

# Group by 'timestamp' and 'response_code', summing the 'count'
grouped_df = df_filtered.groupby(['timestamp', 'response_code']).sum().reset_index()

# Pivot the DataFrame to make 'response_code' values as columns
pivot_df = grouped_df.pivot(index='timestamp', columns='response_code', values='count').fillna(0)

# Plotting as a bar chart with text annotations
ax = pivot_df.plot(kind='bar', stacked=True, figsize=(10, 6))

# Add text annotations on top of each bar
for p in ax.patches:
    width, height = p.get_width(), p.get_height()
    x, y = p.get_xy() 
    ax.annotate(f'{height}', (x + width/2, y + height), ha='center', va='center', color='black', fontsize=8)

plt.title('Response Codes Over Time')
plt.xlabel('Timestamp')
plt.ylabel('Count')
plt.legend(title='Response Code', bbox_to_anchor=(1.05, 1), loc='upper left')
plt.show()
